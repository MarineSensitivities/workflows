---
title: "github_mgt"
format: html
---

## Apply label across repositories

```{r}
librarian::shelf(
  gitcreds, gh, glue)

org <- "MarineSensitivities"

lbls_custom <- list(
  list(
    name = "spatial-units",
    description = "spatial units for analysis and comparison, e.g. regions, planning areas, aliquots, etc.",
    color       = "89E836"))

# get repositories
repos_lst <- gh(glue("GET /orgs/{org}/repos"))
(repos <- vapply(repos_lst, "[[", "", "name"))

# add label (if missing)
for (lbl in lbls_custom){ # lbl = lbls_custom[[1]]
  browser()
  cat(glue("adding label {lbl$name} to {length(repos)} repositories\n"))
      
  for (repo in repos){
    repo_lbls <- gh(glue("GET /repos/{org}/{repo}/labels")) |> 
      vapply("[[", "", "name")
  
    if (lbl$name %in% repo_lbls){
      print(glue("  {repo}: label {lbl$name} already exists"))
    } else {
      print(glue("  {repo}: adding label {lbl$name}"))
      gh(
        glue("POST /repos/{org}/{repo}/labels"),
        name        = lbl$name,
        description = lbl$description,
        color       = lbl$color)
    }
  }
}

# TODO: move to functions in new ecoquants/ghmgt R package
```
